<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polls & Surveys - HRMS Social Connect</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <h1>üìä Polls & Surveys</h1>
            <p>Share your voice and participate in company feedback</p>
            <a href="dashboard.html" class="btn btn-secondary" style="margin-top: var(--spacing-4);">
                ‚Üê Back to Dashboard
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div style="max-width: 800px; margin: 0 auto;">
            <!-- Create Poll/Survey -->
            <section class="card" style="margin-bottom: var(--spacing-6);">
                <h2>üìù Create New Poll/Survey</h2>
                <form id="pollForm">
                    <div class="form-group">
                        <label for="pollTitle" class="form-label">Title *</label>
                        <input type="text" id="pollTitle" class="form-input" placeholder="Enter poll/survey title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="pollType" class="form-label">Type</label>
                        <select id="pollType" class="form-input" onchange="togglePollType()">
                            <option value="poll">üìä Quick Poll</option>
                            <option value="survey">üìã Survey</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pollQuestion" class="form-label">Question *</label>
                        <textarea id="pollQuestion" class="form-input" rows="2" placeholder="Enter your question" required></textarea>
                    </div>
                    
                    <div id="optionsContainer">
                        <label class="form-label">Options *</label>
                        <div id="pollOptions">
                            <div class="form-group">
                                <input type="text" class="form-input poll-option-input" placeholder="Option 1" required>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-input poll-option-input" placeholder="Option 2" required>
                            </div>
                        </div>
                        <button type="button" onclick="addOption()" class="btn btn-secondary" style="margin-bottom: var(--spacing-4);">‚ûï Add Option</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="pollDuration" class="form-label">Duration</label>
                        <select id="pollDuration" class="form-input">
                            <option value="1">1 Day</option>
                            <option value="3">3 Days</option>
                            <option value="7" selected>1 Week</option>
                            <option value="14">2 Weeks</option>
                            <option value="30">1 Month</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-3);">
                        <button type="submit" class="btn btn-primary">üöÄ Create Poll</button>
                        <button type="button" onclick="clearPollForm()" class="btn btn-secondary">üóëÔ∏è Clear</button>
                    </div>
                </form>
            </section>

            <!-- Active Polls/Surveys -->
            <section class="card" style="margin-bottom: var(--spacing-6);">
                <h2>üî• Active Polls & Surveys</h2>
                <div id="activePolls">
                    <!-- Active polls will be loaded here -->
                </div>
            </section>

            <!-- Completed Polls/Surveys -->
            <section class="card">
                <h2>‚úÖ Completed Polls & Surveys</h2>
                <div id="completedPolls">
                    <!-- Completed polls will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer style="text-align: center; padding: var(--spacing-8); color: var(--gray-500); border-top: 1px solid var(--gray-200); margin-top: var(--spacing-16);">
        <div class="container">
            <p>&copy; 2024 HRMS Social Connect. Built with modern web technologies.</p>
        </div>
    </footer>

    <script>
        // Sample polls and surveys data
        let polls = [
            {
                id: 1,
                title: "Preferred Work Schedule",
                question: "What work schedule would you prefer for the upcoming quarter?",
                type: "poll",
                options: [
                    { text: "9 AM - 5 PM", votes: 45 },
                    { text: "10 AM - 6 PM", votes: 32 },
                    { text: "Flexible hours", votes: 78 },
                    { text: "4-day work week", votes: 23 }
                ],
                totalVotes: 178,
                status: "active",
                createdBy: "HR Department",
                createdDate: "2024-01-15",
                endDate: "2024-01-22",
                userVoted: false
            },
            {
                id: 2,
                title: "Office Lunch Options",
                question: "Which lunch option would you like to see more often in our cafeteria?",
                type: "poll",
                options: [
                    { text: "Vegetarian meals", votes: 67 },
                    { text: "International cuisine", votes: 89 },
                    { text: "Healthy salads", votes: 54 },
                    { text: "Local specialties", votes: 43 }
                ],
                totalVotes: 253,
                status: "active",
                createdBy: "Facilities Team",
                createdDate: "2024-01-16",
                endDate: "2024-01-23",
                userVoted: true,
                userChoice: 1
            },
            {
                id: 3,
                title: "Employee Satisfaction Survey",
                question: "How satisfied are you with your current role and work environment?",
                type: "survey",
                options: [
                    { text: "Very satisfied", votes: 34 },
                    { text: "Satisfied", votes: 67 },
                    { text: "Neutral", votes: 23 },
                    { text: "Dissatisfied", votes: 8 },
                    { text: "Very dissatisfied", votes: 3 }
                ],
                totalVotes: 135,
                status: "completed",
                createdBy: "Management",
                createdDate: "2024-01-01",
                endDate: "2024-01-14",
                userVoted: true,
                userChoice: 1
            }
        ];

        function loadPolls() {
            const activeContainer = document.getElementById('activePolls');
            const completedContainer = document.getElementById('completedPolls');
            
            const activePolls = polls.filter(poll => poll.status === 'active');
            const completedPolls = polls.filter(poll => poll.status === 'completed');
            
            // Load active polls
            if (activePolls.length === 0) {
                activeContainer.innerHTML = '<div class="no-results">No active polls or surveys at the moment.</div>';
            } else {
                activeContainer.innerHTML = activePolls.map(poll => createPollCard(poll)).join('');
            }
            
            // Load completed polls
            if (completedPolls.length === 0) {
                completedContainer.innerHTML = '<div class="no-results">No completed polls or surveys yet.</div>';
            } else {
                completedContainer.innerHTML = completedPolls.map(poll => createPollCard(poll)).join('');
            }
        }

        function createPollCard(poll) {
            const isActive = poll.status === 'active';
            const canVote = isActive && !poll.userVoted;
            const daysLeft = isActive ? Math.ceil((new Date(poll.endDate) - new Date()) / (1000 * 60 * 60 * 24)) : 0;
            
            return `
                <div class="card" style="margin-bottom: var(--spacing-4); border-left: 4px solid ${isActive ? 'var(--secondary-color)' : 'var(--gray-400)'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-3);">
                        <div>
                            <h3 style="margin-bottom: var(--spacing-2);">${poll.title}</h3>
                            <p style="color: var(--gray-600); margin-bottom: var(--spacing-3);">${poll.question}</p>
                        </div>
                        <div style="text-align: right;">
                            <span style="background: ${isActive ? 'var(--secondary-color)' : 'var(--gray-400)'}; color: white; padding: var(--spacing-1) var(--spacing-2); border-radius: var(--radius-sm); font-size: var(--font-size-xs);">
                                ${poll.type.toUpperCase()}
                            </span>
                            ${isActive ? `<div style="color: var(--gray-500); font-size: var(--font-size-sm); margin-top: var(--spacing-1);">${daysLeft} days left</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="poll-options-container">
                        ${poll.options.map((option, index) => `
                            <div class="poll-option ${canVote ? 'clickable' : ''} ${poll.userVoted && poll.userChoice === index ? 'selected' : ''}" 
                                 ${canVote ? `onclick="voteOnPoll(${poll.id}, ${index})"` : ''}>
                                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                    <span>${option.text}</span>
                                    <span style="font-weight: 600;">${option.votes} votes</span>
                                </div>
                                ${!canVote ? `
                                    <div class="poll-result-bar" style="margin-top: var(--spacing-2);">
                                        <div class="poll-result-fill" style="width: ${(option.votes / poll.totalVotes * 100)}%;"></div>
                                        <div class="poll-result-text">${Math.round(option.votes / poll.totalVotes * 100)}%</div>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-4); padding-top: var(--spacing-3); border-top: 1px solid var(--gray-200);">
                        <div style="color: var(--gray-500); font-size: var(--font-size-sm);">
                            <span>üë§ ${poll.createdBy}</span> ‚Ä¢ 
                            <span>üìÖ ${new Date(poll.createdDate).toLocaleDateString()}</span> ‚Ä¢ 
                            <span>üó≥Ô∏è ${poll.totalVotes} total votes</span>
                        </div>
                        ${poll.userVoted ? '<span style="color: var(--secondary-color); font-size: var(--font-size-sm);">‚úÖ You voted</span>' : ''}
                    </div>
                </div>
            `;
        }

        function voteOnPoll(pollId, optionIndex) {
            const poll = polls.find(p => p.id === pollId);
            if (poll && !poll.userVoted && poll.status === 'active') {
                poll.options[optionIndex].votes++;
                poll.totalVotes++;
                poll.userVoted = true;
                poll.userChoice = optionIndex;
                
                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success';
                alertDiv.textContent = 'Thank you for voting!';
                document.querySelector('main .container').insertBefore(alertDiv, document.querySelector('main .container').firstChild);
                
                setTimeout(() => alertDiv.remove(), 3000);
                
                loadPolls();
            }
        }

        function addOption() {
            const optionsContainer = document.getElementById('pollOptions');
            const optionCount = optionsContainer.children.length + 1;
            
            const newOption = document.createElement('div');
            newOption.className = 'form-group';
            newOption.innerHTML = `
                <div style="display: flex; gap: var(--spacing-2);">
                    <input type="text" class="form-input poll-option-input" placeholder="Option ${optionCount}" required>
                    <button type="button" onclick="removeOption(this)" class="btn btn-secondary">‚ùå</button>
                </div>
            `;
            
            optionsContainer.appendChild(newOption);
        }

        function removeOption(button) {
            const optionsContainer = document.getElementById('pollOptions');
            if (optionsContainer.children.length > 2) {
                button.closest('.form-group').remove();
            }
        }

        function togglePollType() {
            const pollType = document.getElementById('pollType').value;
            const submitButton = document.querySelector('#pollForm button[type="submit"]');
            
            if (pollType === 'survey') {
                submitButton.textContent = 'üöÄ Create Survey';
            } else {
                submitButton.textContent = 'üöÄ Create Poll';
            }
        }

        function clearPollForm() {
            document.getElementById('pollForm').reset();
            const optionsContainer = document.getElementById('pollOptions');
            optionsContainer.innerHTML = `
                <div class="form-group">
                    <input type="text" class="form-input poll-option-input" placeholder="Option 1" required>
                </div>
                <div class="form-group">
                    <input type="text" class="form-input poll-option-input" placeholder="Option 2" required>
                </div>
            `;
        }

        // Handle form submission
        document.getElementById('pollForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('pollTitle').value;
            const type = document.getElementById('pollType').value;
            const question = document.getElementById('pollQuestion').value;
            const duration = parseInt(document.getElementById('pollDuration').value);
            
            const optionInputs = document.querySelectorAll('.poll-option-input');
            const options = Array.from(optionInputs).map(input => ({
                text: input.value,
                votes: 0
            })).filter(option => option.text.trim() !== '');
            
            if (options.length < 2) {
                alert('Please provide at least 2 options.');
                return;
            }
            
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + duration);
            
            const newPoll = {
                id: polls.length + 1,
                title: title,
                question: question,
                type: type,
                options: options,
                totalVotes: 0,
                status: 'active',
                createdBy: 'Current User',
                createdDate: new Date().toISOString().split('T')[0],
                endDate: endDate.toISOString().split('T')[0],
                userVoted: false
            };
            
            polls.unshift(newPoll);
            
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success';
            alertDiv.textContent = `${type === 'survey' ? 'Survey' : 'Poll'} created successfully!`;
            this.parentNode.insertBefore(alertDiv, this);
            
            setTimeout(() => alertDiv.remove(), 3000);
            
            this.reset();
            clearPollForm();
            loadPolls();
        });

        // Load polls on page load
        window.addEventListener('load', () => {
            loadPolls();
        });
    </script>
</body>
</html>
